# Boris Life - Work Engine 产品设计文档

**版本**: 2.0
**日期**: 2025-12-27
**作者**: Claude Code Assistant

---

## 一、项目概述

Boris Life 是一个个人生活管理 PWA 应用，基于 Flask + HTML/CSS/JavaScript 构建，支持桌面端和移动端自适应。

### 核心功能
1. **Todo 管理** - 基于艾森豪威尔矩阵的任务管理
2. **鼓励大师** - 激励文字管理
3. **气泡图** - 可视化工具
4. **放松大脑** - 小游戏（蜘蛛游戏、打砖块）
5. **待执行** - Prompt 任务队列
6. **AI 聊天** - 智能助手（开发中）

---

## 二、项目分析报告

### 2.1 当前问题汇总

#### 关键问题（Critical）
| 问题 | 影响 | 位置 |
|------|------|------|
| 移动端拖拽不可用 | Todo核心功能失效 | todo.html:390-407 |
| 无错误处理 | 静默失败，用户困惑 | 全局 fetch 调用 |
| API密钥明文存储 | 安全风险 | config/config.json |
| 无障碍支持缺失 | 屏幕阅读器无法使用 | 全局 |

#### 主要问题（Major）
| 问题 | 影响 | 位置 |
|------|------|------|
| 无加载状态 | UX差 | 所有API调用 |
| CSS重复/冗余 | 维护困难 | assets/css/ |
| 无深色模式 | 夜间使用刺眼 | 全局 |
| 图片过大 | 加载慢 | avatar.jpg (1.7MB) |
| 无数据分页 | 大数据量性能差 | API层 |

#### 中等问题（Moderate）
| 问题 | 影响 | 位置 |
|------|------|------|
| 全局变量污染 | 代码可维护性差 | JS全局 |
| 硬编码字符串 | 国际化困难 | 多处 |
| 无离线支持 | 断网不可用 | sw.js |

### 2.2 优化空间分析

#### 布局优化
1. 移动端底部导航需要适配 iPhone 安全区域
2. 虚拟键盘弹出时输入框被遮挡
3. 平板设备无专门适配

#### 可靠性优化
1. 所有 API 调用需添加错误处理
2. 需实现重试机制
3. 需添加数据验证

#### 触屏操作优化
1. 拖拽功能需支持触摸事件
2. 需添加手势导航（滑动切换标签）
3. 需添加长按菜单
4. 需添加触觉反馈

---

## 三、20个新功能设计

### 功能列表

| # | 功能名称 | 类型 | 优先级 | 复杂度 |
|---|---------|------|--------|--------|
| 1 | 深色模式 | UI | P0 | 中 |
| 2 | 键盘快捷键 | 无障碍 | P1 | 低 |
| 3 | 触摸拖拽 | 移动端 | P0 | 高 |
| 4 | 任务搜索 | 功能 | P1 | 低 |
| 5 | 任务标签系统 | 功能 | P2 | 中 |
| 6 | 循环任务 | 功能 | P2 | 中 |
| 7 | 数据统计面板 | 功能 | P1 | 中 |
| 8 | 番茄钟 | 功能 | P2 | 中 |
| 9 | 快速添加栏 | UX | P1 | 低 |
| 10 | 数据导出/导入 | 功能 | P1 | 低 |
| 11 | 撤销/重做 | UX | P2 | 高 |
| 12 | 任务模板 | 功能 | P3 | 中 |
| 13 | 每日回顾 | 功能 | P2 | 中 |
| 14 | 成就系统 | 游戏化 | P3 | 中 |
| 15 | 专注模式 | UX | P2 | 低 |
| 16 | 语音输入 | 无障碍 | P3 | 中 |
| 17 | 手势导航 | 移动端 | P1 | 中 |
| 18 | 任务提醒 | 功能 | P2 | 高 |
| 19 | 多语言支持 | 国际化 | P3 | 高 |
| 20 | 数据同步状态 | UX | P1 | 低 |

---

### 功能详细设计

#### 1. 深色模式 (Dark Mode)

**目的**: 减少夜间使用时的眼睛疲劳，节省 OLED 屏幕电量

**实现方案**:
- 使用 CSS 变量定义颜色主题
- 支持系统偏好检测 (`prefers-color-scheme`)
- 提供手动切换开关
- 持久化用户选择到 localStorage

**UI 变更**:
```css
[data-theme="dark"] {
  --bg-primary: #1a1a2e;
  --bg-secondary: #16213e;
  --bg-card: #0f3460;
  --text-primary: #e8e8e8;
  --text-secondary: #a0a0a0;
}
```

**位置**: 顶部导航栏右侧添加切换按钮

---

#### 2. 键盘快捷键 (Keyboard Shortcuts)

**目的**: 提高效率，支持无鼠标操作

**快捷键映射**:
| 快捷键 | 功能 |
|--------|------|
| `N` | 新建任务 |
| `S` | 搜索 |
| `1-4` | 切换象限 |
| `T/W/A` | 切换今日/本周/全部 |
| `Esc` | 关闭弹窗 |
| `Enter` | 确认 |
| `?` | 显示帮助 |

**实现**: 全局键盘事件监听器

---

#### 3. 触摸拖拽 (Touch Drag & Drop)

**目的**: 修复移动端拖拽功能

**实现方案**:
- 使用 Pointer Events API (统一鼠标和触摸)
- 添加拖拽预览效果
- 实现拖拽时的视觉反馈
- 添加触觉反馈 (vibrate)

**代码结构**:
```javascript
element.addEventListener('pointerdown', onDragStart);
element.addEventListener('pointermove', onDragMove);
element.addEventListener('pointerup', onDragEnd);
```

---

#### 4. 任务搜索 (Task Search)

**目的**: 快速定位任务

**功能**:
- 实时搜索过滤
- 高亮匹配文字
- 支持搜索历史
- 快捷键 `S` 或 `/` 激活

**UI**: 顶部搜索栏，下拉显示结果

---

#### 5. 任务标签系统 (Task Tags)

**目的**: 更灵活的任务分类

**功能**:
- 创建自定义标签
- 为任务添加多个标签
- 按标签筛选
- 标签颜色自定义

**数据结构**:
```json
{
  "id": "xxx",
  "text": "任务内容",
  "tags": ["工作", "紧急"],
  "quadrant": "important-urgent"
}
```

---

#### 6. 循环任务 (Recurring Tasks)

**目的**: 支持重复性任务

**功能**:
- 每日/每周/每月重复
- 自定义重复规则
- 自动创建下一期任务

**UI**: 任务创建时添加"重复"选项

---

#### 7. 数据统计面板 (Statistics Dashboard)

**目的**: 可视化任务完成情况

**内容**:
- 今日/本周/本月完成数
- 各象限分布饼图
- 完成趋势折线图
- 平均完成时间

**位置**: 主页新增统计卡片

---

#### 8. 番茄钟 (Pomodoro Timer)

**目的**: 提高专注力

**功能**:
- 25分钟工作 + 5分钟休息
- 可自定义时长
- 声音/振动提醒
- 与任务关联

**UI**: 浮动按钮或独立页面

---

#### 9. 快速添加栏 (Quick Add Bar)

**目的**: 降低添加任务的门槛

**功能**:
- 固定在页面底部
- 一键添加到"今日"
- 自然语言解析（如"明天 开会"）

**UI**: 底部固定输入框 + 发送按钮

---

#### 10. 数据导出/导入 (Data Export/Import)

**目的**: 数据备份和迁移

**支持格式**:
- JSON (完整备份)
- CSV (Excel 兼容)
- Markdown (可读格式)

**UI**: 设置页面添加导出/导入按钮

---

#### 11. 撤销/重做系统 (Undo/Redo)

**目的**: 防止误操作

**功能**:
- 记录最近 20 个操作
- Ctrl+Z 撤销
- Ctrl+Y 重做
- Toast 提示 + 撤销按钮

---

#### 12. 任务模板 (Task Templates)

**目的**: 快速创建常用任务

**功能**:
- 保存任务为模板
- 从模板快速创建
- 模板分类管理

---

#### 13. 每日回顾 (Daily Review)

**目的**: 反思和规划

**功能**:
- 每日弹窗回顾
- 显示今日完成/未完成
- 快速规划明日
- 记录心情/笔记

---

#### 14. 成就系统 (Achievements)

**目的**: 游戏化激励

**成就示例**:
- 连续7天完成任务
- 完成100个任务
- 清空"重要紧急"象限
- 使用番茄钟10次

---

#### 15. 专注模式 (Focus Mode)

**目的**: 减少干扰

**功能**:
- 隐藏非必要UI元素
- 只显示当前任务
- 全屏模式
- 快捷键 `F` 切换

---

#### 16. 语音输入 (Voice Input)

**目的**: 解放双手

**功能**:
- 使用 Web Speech API
- 语音转文字添加任务
- 语音命令（如"添加任务 买牛奶"）

---

#### 17. 手势导航 (Gesture Navigation)

**目的**: 优化移动端体验

**手势**:
- 左右滑动切换标签
- 下拉刷新
- 长按显示菜单
- 双指缩放

---

#### 18. 任务提醒 (Task Reminders)

**目的**: 及时提醒

**功能**:
- 设置提醒时间
- 浏览器通知
- 重复提醒选项

**实现**: Notification API + Service Worker

---

#### 19. 多语言支持 (i18n)

**目的**: 国际化

**支持语言**:
- 简体中文 (默认)
- English
- 繁體中文

**实现**: i18n JSON 文件 + 动态加载

---

#### 20. 数据同步状态 (Sync Status)

**目的**: 让用户了解数据保存状态

**功能**:
- 显示"已保存"/"保存中"/"保存失败"
- 自动重试失败请求
- 离线时显示提示

**UI**: 顶部状态指示器

---

## 四、实现计划

### 第一阶段 (Core Fixes)
1. ✅ 深色模式
2. ✅ 触摸拖拽修复
3. ✅ 数据同步状态
4. ✅ 快速添加栏

### 第二阶段 (UX Improvements)
5. ✅ 任务搜索
6. ✅ 键盘快捷键
7. ✅ 手势导航
8. ✅ 数据统计面板

### 第三阶段 (New Features)
9. ✅ 番茄钟
10. ✅ 数据导出/导入
11. ✅ 每日回顾
12. ✅ 专注模式

### 第四阶段 (Advanced)
13-20. 任务标签、循环任务、成就系统等

---

## 五、技术架构更新

### 5.1 CSS 架构
```
assets/css/
├── base.css          # 共享变量和基础样式
├── themes/
│   ├── light.css     # 浅色主题
│   └── dark.css      # 深色主题
├── components/       # 组件样式
└── pages/            # 页面特定样式
```

### 5.2 JavaScript 模块化
```javascript
// 使用 IIFE 避免全局污染
const TodoApp = (function() {
  // 私有变量和方法
  return {
    // 公开 API
    init: function() {},
    addTask: function() {},
    // ...
  };
})();
```

### 5.3 错误处理标准
```javascript
async function apiCall(url, options) {
  try {
    const response = await fetch(url, options);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    return await response.json();
  } catch (error) {
    showToast('操作失败，请重试', 'error');
    console.error('API Error:', error);
    throw error;
  }
}
```

---

## 六、回滚策略

### 6.1 版本控制
- 每个功能一个 git commit
- 使用语义化版本号
- 保留 .backup 文件

### 6.2 数据备份
- 每次修改前自动备份
- 保留最近 5 个版本
- 支持一键回滚

### 6.3 功能开关
- 新功能默认关闭
- localStorage 存储开关状态
- 可随时禁用问题功能

---

## 附录

### A. 文件变更清单
（实现后更新）

### B. API 变更
（实现后更新）

### C. 测试用例
（实现后更新）
