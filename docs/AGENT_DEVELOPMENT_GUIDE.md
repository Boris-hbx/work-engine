# Agent-Driven Development (ADD) 开发范式指南

**版本**: 1.0
**日期**: 2025-12-27
**适用项目**: Boris Life - Work Engine

---

## 一、概述

### 1.1 什么是 Agent-Driven Development (ADD)

Agent-Driven Development 是一种新型软件开发范式，开发者通过与 AI Agent（如 Claude Code）协作完成软件工程任务。这种范式改变了传统的"人写代码"模式，转变为"人描述需求，Agent 实现代码"的协作模式。

### 1.2 核心理念

- **意图驱动**: 开发者表达意图，Agent 理解并执行
- **对话式开发**: 通过自然语言交流完成开发任务
- **增量迭代**: 小步快跑，持续验证
- **文档即代码**: 详尽的文档让 Agent 能快速理解上下文

### 1.3 适用场景

- 快速原型开发
- 功能迭代和优化
- Bug 修复和调试
- 代码重构
- 文档生成

---

## 二、开发流程

### 2.1 标准开发流程

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  需求录入   │ -> │  Agent分析  │ -> │  实现开发   │ -> │  验证测试   │
│  (Prompt)   │    │  (Planning) │    │  (Coding)   │    │  (Testing)  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
                                                                │
                                                                v
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  经验沉淀   │ <- │  文档更新   │ <- │  代码提交   │ <- │  人工审核   │
│ (Learning)  │    │   (Docs)    │    │  (Commit)   │    │  (Review)   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

### 2.2 待验收机制 (重要!)

**每个任务完成后，Agent 必须执行以下步骤：**

1. **记录到待验收清单**: 将任务信息写入 `docs/PENDING_ACCEPTANCE.md`
2. **提供验收信息**: 包含功能位置、操作方式、预期效果
3. **等待用户反馈**: 用户验收后标记通过或提出问题

**待验收记录格式** (Markdown 表格):
```markdown
### acc-XXX: 功能名称
| 项目 | 内容 |
|------|------|
| **Prompt ID** | 关联的prompt ID |
| **功能** | 功能描述 |
| **位置** | 功能位置（页面/按钮/快捷键）|
| **验收步骤** | 1. 步骤一 2. 步骤二 |
| **状态** | ⏳ 待验收 |
| **备注** | |
```

**Agent 执行规范**:
- 每完成一个功能，立即添加到 `docs/PENDING_ACCEPTANCE.md`
- 在回复中明确告知用户新增了哪些待验收项
- 如用户反馈问题，优先修复后重新提交验收
- 验收通过后，将条目移至"已验收项目"区域

### 2.3 流程详解

#### 阶段一：需求录入 (Prompt Input)

**输入方式**:
- 通过 `prompt-todo.json` 提交待执行任务
- 直接在对话中描述需求
- 提供截图或参考资料

**Prompt 编写规范**:
```
【好的 Prompt 示例】
"在 Todo 页面添加搜索功能，要求：
1. 实时搜索过滤
2. 高亮匹配文字
3. 支持快捷键 S 激活
4. 搜索结果为空时显示提示"

【不好的 Prompt 示例】
"加个搜索"
```

**Prompt 要素**:
- 功能描述（做什么）
- 验收标准（怎样算完成）
- 技术约束（如有）
- 参考资料（如有）

#### 阶段二：Agent 分析 (Planning)

Agent 在执行前会：
1. 分析现有代码结构
2. 识别影响范围
3. 设计实现方案
4. 列出执行步骤（TodoWrite）

**开发者应关注**:
- Agent 的计划是否合理
- 是否有遗漏的边界情况
- 是否需要补充约束条件

#### 阶段三：实现开发 (Coding)

Agent 执行：
1. 读取相关文件
2. 编写/修改代码
3. 更新配置
4. 处理依赖

**开发者职责**:
- 监控执行进度
- 及时反馈问题
- 提供必要澄清

#### 阶段四：验证测试 (Testing)

验证方式：
1. Agent 自检（运行测试）
2. 开发者手动验证
3. 截图/录屏确认

#### 阶段五：人工审核 (Review)

审核要点：
- 代码质量
- 安全性
- 性能影响
- 是否符合预期

#### 阶段六：代码提交 (Commit)

提交规范：
- 清晰的 commit message
- 关联对应的 prompt ID
- 标注变更范围

#### 阶段七：文档更新 (Documentation)

必须更新的文档：
- `README.md`（如有新功能）
- `CHANGELOG.md`（版本变更）
- `PRODUCT_DESIGN.md`（设计变更）

#### 阶段八：经验沉淀 (Learning)

记录内容：
- 遇到的问题及解决方案
- 可复用的模式
- 需要改进的流程

---

## 三、项目规范

### 3.1 目录结构规范

```
project/
├── backend/           # 后端代码
│   ├── app.py        # 主应用
│   └── tests/        # 测试文件
├── frontend/          # 前端代码
│   └── templates/    # 模板文件
├── assets/           # 静态资源
│   ├── css/         # 样式文件
│   ├── js/          # JavaScript
│   └── images/      # 图片
├── data/             # 数据文件（私有）
├── config/           # 配置文件
├── docs/             # 文档
│   ├── AGENT_DEVELOPMENT_GUIDE.md  # 本文档
│   ├── PRODUCT_DESIGN.md           # 产品设计
│   ├── REQUIREMENTS.md             # 需求文档
│   ├── CHANGELOG.md                # 变更日志
│   └── backup/                     # 数据备份
├── PrtSc/            # 截图（供 Agent 参考）
├── README.md         # 项目说明
└── requirements.txt  # 依赖清单
```

### 3.2 文件命名规范

| 类型 | 规范 | 示例 |
|------|------|------|
| Python | snake_case | `user_service.py` |
| JavaScript | camelCase | `userService.js` |
| CSS | kebab-case | `user-profile.css` |
| 模板 | snake_case | `user_profile.html` |
| 文档 | UPPER_SNAKE_CASE | `CHANGELOG.md` |

### 3.3 代码规范

#### Python
- 遵循 PEP 8
- 函数添加 docstring
- 类型注解（推荐）

#### JavaScript
- 使用 `var` 保持兼容（或声明 ES6+）
- 函数声明优于箭头函数（全局作用域）
- 适当添加注释

#### CSS
- 使用 CSS 变量管理主题
- 避免 !important（除非必要）
- 按功能分组组织规则

### 3.4 提交规范

#### Commit Message 格式
```
<类型>(<范围>): <描述>

[可选的详细说明]

[可选的关联 ID]
```

#### 类型
- `feat`: 新功能
- `fix`: Bug 修复
- `docs`: 文档更新
- `style`: 样式调整
- `refactor`: 代码重构
- `perf`: 性能优化
- `test`: 测试相关

#### 示例
```
feat(todo): Add search functionality with highlighting

- Real-time search filtering
- Keyboard shortcut (S) support
- Highlight matching text

Prompt-ID: 37804d41
```

---

## 四、文档管理

### 4.1 必须维护的文档

| 文档 | 用途 | 更新时机 |
|------|------|----------|
| `README.md` | 项目概述 | 新增功能时 |
| `CHANGELOG.md` | 版本历史 | 每次发布 |
| `REQUIREMENTS.md` | 需求清单 | 需求变更时 |
| `PRODUCT_DESIGN.md` | 产品设计 | 架构变更时 |
| `AGENT_DEVELOPMENT_GUIDE.md` | 开发规范 | 流程优化时 |

### 4.2 Prompt 管理

#### prompt-todo.json 结构
```json
{
  "id": "唯一ID",
  "content": "Prompt 内容",
  "status": "待修改|待执行|已执行",
  "created_at": "创建时间",
  "completed_at": "完成时间（可选）"
}
```

#### 状态流转
```
待修改 -> 待执行 -> 已执行
   ↑         ↓
   └─────────┘
   (需要修改时退回)
```

### 4.3 截图管理

**用途**: 为 Agent 提供视觉参考

**存放位置**: `PrtSc/` 目录

**命名规范**: `<功能>_<描述>.png`
- 示例: `todo_search_bar.png`
- 示例: `mobile_game_screen.png`

**使用方式**: 在 Prompt 中引用截图路径

---

## 五、质量保障

### 5.1 代码审查检查清单

- [ ] 代码符合项目规范
- [ ] 无明显安全漏洞（XSS、SQL注入等）
- [ ] 无硬编码敏感信息
- [ ] 错误处理完善
- [ ] 性能无明显问题
- [ ] 移动端兼容（如适用）

### 5.2 测试策略

| 层级 | 方法 | 责任方 |
|------|------|--------|
| 单元测试 | 自动化测试 | Agent |
| 功能测试 | 手动验证 | 开发者 |
| 集成测试 | API 测试 | Agent |
| UI 测试 | 截图对比 | 开发者 |

### 5.3 回滚策略

**代码回滚**:
```bash
git revert <commit-hash>
```

**数据回滚**:
- 使用 `docs/backup/` 中的备份
- 通过 `/api/import` 恢复

---

## 六、经验沉淀

### 6.1 常见问题与解决方案

#### 问题 1: Agent 理解偏差
**表现**: 实现与预期不符
**解决**:
- 提供更详细的 Prompt
- 附加截图或示例
- 分步骤拆解任务

#### 问题 2: 代码风格不一致
**表现**: 新代码与现有代码风格差异大
**解决**:
- 在 Prompt 中说明遵循现有风格
- 让 Agent 先阅读相关文件

#### 问题 3: 影响范围失控
**表现**: 修改了不该修改的文件
**解决**:
- 明确指定修改范围
- 使用 "只修改 xxx 文件"

### 6.2 最佳实践

1. **小步快跑**: 大任务拆成小任务
2. **即时验证**: 每完成一步就验证
3. **详细描述**: Prompt 宁可啰嗦也要清晰
4. **保持上下文**: 重要决策记录在案
5. **善用截图**: 一图胜千言
6. **及时备份**: 重要变更前先备份

### 6.3 持续改进

每周/每月回顾：
- 哪些 Prompt 执行顺利？为什么？
- 哪些任务需要多次返工？如何改进？
- 有哪些可以模板化的 Prompt？
- 文档是否需要补充？

---

## 七、附录

### A. Prompt 模板库

#### 功能开发模板
```
【功能名称】: xxx
【功能描述】:
详细描述功能需求...

【验收标准】:
1. xxx
2. xxx

【技术约束】:
- 使用现有 xxx 组件
- 兼容移动端

【参考】:
- 截图: PrtSc/xxx.png
- 类似功能: xxx
```

#### Bug 修复模板
```
【问题描述】:
具体描述问题现象...

【复现步骤】:
1. xxx
2. xxx

【期望行为】:
xxx

【实际行为】:
xxx

【相关文件】:
- xxx.py
- xxx.html
```

#### 优化改进模板
```
【优化目标】: xxx

【当前问题】:
描述现状...

【期望效果】:
描述优化后的效果...

【注意事项】:
- 不要影响 xxx
- 保持 xxx 兼容
```

### B. 术语表

| 术语 | 说明 |
|------|------|
| ADD | Agent-Driven Development |
| Prompt | 向 Agent 发送的指令 |
| Context | Agent 可获取的上下文信息 |
| TodoWrite | Agent 的任务追踪工具 |
| Plan Mode | Agent 的规划模式 |

---

**文档维护者**: Claude Code Agent
**最后更新**: 2025-12-27
