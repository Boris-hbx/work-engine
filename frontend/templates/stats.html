{% extends "base.html" %}

{% block title %}Project Stats - Boris Life{% endblock %}

{% block content %}
<div class="stats-page">
    <div class="stats-header">
        <h1 class="stats-title">Project Statistics</h1>
        <p class="stats-subtitle">Work Engine Development Metrics</p>
    </div>

    <div class="stats-grid">
        <!-- Code Metrics Card -->
        <div class="stats-card">
            <div class="card-header">
                <span class="card-icon">üìä</span>
                <h3>Code Metrics</h3>
            </div>
            <div class="card-content">
                <div class="stat-row">
                    <span class="stat-label">Python</span>
                    <span class="stat-value" id="python-lines">-</span>
                    <span class="stat-unit">lines</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">HTML</span>
                    <span class="stat-value" id="html-lines">-</span>
                    <span class="stat-unit">lines</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">CSS</span>
                    <span class="stat-value" id="css-lines">-</span>
                    <span class="stat-unit">lines</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">JavaScript</span>
                    <span class="stat-value" id="js-lines">-</span>
                    <span class="stat-unit">lines</span>
                </div>
                <div class="stat-row total">
                    <span class="stat-label">Total</span>
                    <span class="stat-value" id="total-lines">-</span>
                    <span class="stat-unit">lines</span>
                </div>
            </div>
        </div>

        <!-- Git Stats Card -->
        <div class="stats-card">
            <div class="card-header">
                <span class="card-icon">üìù</span>
                <h3>Git History</h3>
            </div>
            <div class="card-content">
                <div class="stat-row highlight">
                    <span class="stat-label">Total Commits</span>
                    <span class="stat-value" id="commit-count">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Version</span>
                    <span class="stat-value" id="version">-</span>
                </div>
                <div class="authors-list" id="authors-list">
                    <!-- Authors will be populated by JS -->
                </div>
            </div>
        </div>

        <!-- Features Card -->
        <div class="stats-card wide">
            <div class="card-header">
                <span class="card-icon">üöÄ</span>
                <h3>Core Features</h3>
            </div>
            <div class="card-content">
                <div class="features-grid" id="core-features">
                    <!-- Features will be populated by JS -->
                </div>
            </div>
        </div>

        <!-- Games Card -->
        <div class="stats-card">
            <div class="card-header">
                <span class="card-icon">üéÆ</span>
                <h3>Games</h3>
            </div>
            <div class="card-content">
                <ul class="feature-list" id="games-list">
                    <!-- Games will be populated by JS -->
                </ul>
            </div>
        </div>

        <!-- Tower Defense Features Card -->
        <div class="stats-card">
            <div class="card-header">
                <span class="card-icon">üè∞</span>
                <h3>Tower Defense</h3>
            </div>
            <div class="card-content">
                <ul class="feature-list" id="tower-features">
                    <!-- Tower defense features will be populated by JS -->
                </ul>
            </div>
        </div>
    </div>

    <div class="stats-footer">
        <p>Last updated: <span id="last-updated">-</span></p>
    </div>
</div>

<style>
.stats-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.stats-header {
    text-align: center;
    margin-bottom: 30px;
}

.stats-title {
    font-size: 2rem;
    color: var(--text-color, #333);
    margin-bottom: 8px;
}

.stats-subtitle {
    color: var(--text-secondary, #666);
    font-size: 1rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stats-card {
    background: var(--card-bg, #fff);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    border: 1px solid var(--border-color, #eee);
}

.stats-card.wide {
    grid-column: 1 / -1;
}

.card-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border-color, #eee);
}

.card-icon {
    font-size: 1.5rem;
}

.card-header h3 {
    margin: 0;
    font-size: 1.1rem;
    color: var(--text-color, #333);
}

.stat-row {
    display: flex;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid var(--border-light, #f5f5f5);
}

.stat-row:last-child {
    border-bottom: none;
}

.stat-row.total {
    margin-top: 8px;
    padding-top: 12px;
    border-top: 2px solid var(--primary-color, #7c3aed);
    font-weight: 600;
}

.stat-row.highlight {
    background: linear-gradient(90deg, var(--primary-light, #f3e8ff), transparent);
    margin: -8px -12px 8px;
    padding: 12px;
    border-radius: 8px;
}

.stat-label {
    flex: 1;
    color: var(--text-secondary, #666);
}

.stat-value {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary-color, #7c3aed);
    margin-right: 4px;
}

.stat-unit {
    font-size: 0.85rem;
    color: var(--text-muted, #999);
}

.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
}

.feature-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    background: var(--bg-light, #f8f9fa);
    border-radius: 8px;
    font-size: 0.9rem;
}

.feature-item::before {
    content: '‚úì';
    color: var(--success-color, #10b981);
    font-weight: bold;
}

.feature-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.feature-list li {
    padding: 8px 0;
    border-bottom: 1px solid var(--border-light, #f5f5f5);
    display: flex;
    align-items: center;
    gap: 8px;
}

.feature-list li:last-child {
    border-bottom: none;
}

.feature-list li::before {
    content: '‚Ä¢';
    color: var(--primary-color, #7c3aed);
    font-weight: bold;
}

.authors-list {
    margin-top: 12px;
}

.author-item {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    font-size: 0.9rem;
}

.author-name {
    color: var(--text-color, #333);
}

.author-commits {
    color: var(--text-secondary, #666);
    font-size: 0.85rem;
}

.stats-footer {
    text-align: center;
    padding: 20px;
    color: var(--text-muted, #999);
    font-size: 0.85rem;
}

@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }

    .stats-card.wide {
        grid-column: 1;
    }

    .features-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    fetch('/api/project/stats')
        .then(res => res.json())
        .then(data => {
            // Code metrics
            document.getElementById('python-lines').textContent = data.code.python.toLocaleString();
            document.getElementById('html-lines').textContent = data.code.html.toLocaleString();
            document.getElementById('css-lines').textContent = data.code.css.toLocaleString();
            document.getElementById('js-lines').textContent = data.code.javascript.toLocaleString();
            document.getElementById('total-lines').textContent = data.code.total.toLocaleString();

            // Git stats
            document.getElementById('commit-count').textContent = data.git.commits;
            document.getElementById('version').textContent = 'v' + data.version;

            // Authors
            var authorsList = document.getElementById('authors-list');
            authorsList.innerHTML = '<div class="authors-header" style="font-weight:600;margin-bottom:8px;">Contributors</div>';
            data.git.authors.forEach(function(author) {
                var div = document.createElement('div');
                div.className = 'author-item';
                div.innerHTML = '<span class="author-name">' + author.name + '</span>' +
                               '<span class="author-commits">' + author.commits + ' commits</span>';
                authorsList.appendChild(div);
            });

            // Core features
            var coreFeatures = document.getElementById('core-features');
            data.features.core.forEach(function(feature) {
                var div = document.createElement('div');
                div.className = 'feature-item';
                div.textContent = feature;
                coreFeatures.appendChild(div);
            });

            // Games
            var gamesList = document.getElementById('games-list');
            data.features.games.forEach(function(game) {
                var li = document.createElement('li');
                li.textContent = game;
                gamesList.appendChild(li);
            });

            // Tower defense features
            var towerFeatures = document.getElementById('tower-features');
            data.features.tower_defense.forEach(function(feature) {
                var li = document.createElement('li');
                li.textContent = feature;
                towerFeatures.appendChild(li);
            });

            // Last updated
            var date = new Date(data.last_updated);
            document.getElementById('last-updated').textContent = date.toLocaleString();
        })
        .catch(function(err) {
            console.error('Failed to load stats:', err);
        });
});
</script>
{% endblock %}
