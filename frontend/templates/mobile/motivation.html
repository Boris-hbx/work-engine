{% extends "mobile/base.html" %}

{% block title %}é¼“åŠ±å¤§å¸ˆ - Boris Life{% endblock %}
{% block page_title %}ç¨‹åºå‘˜é¼“åŠ±å¤§å¸ˆ{% endblock %}

{% block header_actions %}
<button class="header-btn" onclick="shuffleQuote()">ğŸ”„</button>
{% endblock %}

{% block content %}
<div class="toast-container" id="toast-container"></div>

<!-- Quote Display -->
<div class="motivation-card">
    <div class="quote-icon">ğŸ’ª</div>
    <p class="quote-text" id="quote-text">{{ quote }}</p>
    <button class="shuffle-btn" onclick="shuffleQuote()">æ¢ä¸€ä¸ª</button>
</div>

<!-- Category Tabs -->
<div class="category-tabs" id="category-tabs">
    <!-- Categories will be rendered here -->
</div>

<!-- Motivation Content -->
<div class="motivation-content" id="motivation-content">
    <!-- Content will be rendered here -->
</div>

<style>
.motivation-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 30px 20px;
    text-align: center;
    margin-bottom: 20px;
    color: white;
}

.quote-icon {
    font-size: 2.5rem;
    margin-bottom: 12px;
}

.quote-text {
    font-size: 1.1rem;
    line-height: 1.6;
    margin-bottom: 16px;
}

.shuffle-btn {
    padding: 10px 24px;
    border: 2px solid rgba(255,255,255,0.5);
    border-radius: 20px;
    background: transparent;
    color: white;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
}

.shuffle-btn:active {
    background: rgba(255,255,255,0.2);
}

.category-tabs {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    padding-bottom: 8px;
    margin-bottom: 16px;
    -webkit-overflow-scrolling: touch;
}

.category-tab {
    flex-shrink: 0;
    padding: 8px 16px;
    border: none;
    border-radius: 20px;
    background: rgba(255,255,255,0.8);
    color: var(--text-muted);
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
}

.category-tab.active {
    background: var(--primary-color);
    color: white;
}

.motivation-item {
    background: var(--bg-card);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 10px;
    font-size: 0.95rem;
    line-height: 1.6;
    color: var(--text-primary);
}

.motivation-empty {
    text-align: center;
    padding: 40px;
    color: var(--text-muted);
}
</style>

<script>
var motivationData = {};
var currentCategory = null;

function shuffleQuote() {
    fetch('/api/quote/random')
        .then(r => r.json())
        .then(data => {
            document.getElementById('quote-text').textContent = data.quote;
        });
}

function loadMotivation() {
    fetch('/api/motivation')
        .then(r => r.json())
        .then(data => {
            motivationData = data.categories || {};
            renderCategories();
        });
}

function renderCategories() {
    var container = document.getElementById('category-tabs');
    var categories = Object.keys(motivationData);

    if (categories.length === 0) {
        container.innerHTML = '';
        document.getElementById('motivation-content').innerHTML = '<div class="motivation-empty">æš‚æ— å†…å®¹</div>';
        return;
    }

    var html = '';
    categories.forEach(function(cat, index) {
        var active = index === 0 ? 'active' : '';
        html += '<button class="category-tab ' + active + '" onclick="selectCategory(\'' + escapeHtml(cat) + '\')">' + escapeHtml(cat) + '</button>';
    });
    container.innerHTML = html;

    if (!currentCategory && categories.length > 0) {
        currentCategory = categories[0];
    }
    renderContent();
}

function selectCategory(cat) {
    currentCategory = cat;
    document.querySelectorAll('.category-tab').forEach(function(tab) {
        tab.classList.remove('active');
        if (tab.textContent === cat) {
            tab.classList.add('active');
        }
    });
    renderContent();
}

function renderContent() {
    var container = document.getElementById('motivation-content');
    var items = motivationData[currentCategory] || [];

    if (items.length === 0) {
        container.innerHTML = '<div class="motivation-empty">è¯¥åˆ†ç±»æš‚æ— å†…å®¹</div>';
        return;
    }

    var html = '';
    items.forEach(function(item) {
        html += '<div class="motivation-item">' + escapeHtml(item) + '</div>';
    });
    container.innerHTML = html;
}

function escapeHtml(str) {
    if (!str) return '';
    return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>');
}

window.refreshContent = loadMotivation;
loadMotivation();
</script>
{% endblock %}
