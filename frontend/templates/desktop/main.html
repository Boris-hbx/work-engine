{% extends "desktop/base.html" %}

{% block content %}
<div class="main-dashboard">
    <!-- Welcome Header -->
    <div class="dashboard-header">
        <div class="welcome-section">
            <h1 class="welcome-title">Welcome Back, Boris</h1>
            <p class="welcome-date" id="current-date"></p>
        </div>
        <div class="quote-card">
            <span class="quote-icon">ğŸ’¡</span>
            <p class="quote-text">{{ quote }}</p>
        </div>
    </div>

    <!-- Stats Row -->
    <div class="stats-row">
        <!-- å¤©æ°”å¡ç‰‡ -->
        <div class="stat-card weather-card" id="weather-card">
            <div class="stat-icon" id="weather-icon">â˜ï¸</div>
            <div class="stat-info">
                <span class="stat-value" id="weather-temp">--Â°C</span>
                <span class="stat-label" id="weather-desc">æ»‘é“å¢</span>
            </div>
        </div>
        <a href="{{ url_for('todo') }}?tab=today" class="stat-card stat-card-link">
            <div class="stat-icon">ğŸ“‹</div>
            <div class="stat-info">
                <span class="stat-value" id="stat-today-tasks">-</span>
                <span class="stat-label">ä»Šæ—¥å¾…åŠ</span>
            </div>
        </a>
        <a href="{{ url_for('prompt_todo') }}" class="stat-card stat-card-link">
            <div class="stat-icon">â³</div>
            <div class="stat-info">
                <span class="stat-value" id="stat-pending-prompts">-</span>
                <span class="stat-label">å¾…æ‰§è¡ŒPrompt</span>
            </div>
        </a>
        <a href="{{ url_for('todo') }}?tab=week" class="stat-card stat-card-link">
            <div class="stat-icon">ğŸ¯</div>
            <div class="stat-info">
                <span class="stat-value" id="stat-week-tasks">-</span>
                <span class="stat-label">æœ¬å‘¨ä»»åŠ¡</span>
            </div>
        </a>
        <a href="{{ url_for('bubble') }}" class="stat-card stat-card-link">
            <div class="stat-icon">ğŸ“Š</div>
            <div class="stat-info">
                <span class="stat-value" id="stat-bubbles">-</span>
                <span class="stat-label">æ°”æ³¡å›¾</span>
            </div>
        </a>
    </div>

    <!-- Feature Grid -->
    <div class="feature-grid">
        <a href="{{ url_for('todo') }}" class="feature-card feature-todo">
            <div class="feature-icon">âœ…</div>
            <div class="feature-content">
                <h3>Todo</h3>
                <p>å››è±¡é™ä»»åŠ¡ç®¡ç†</p>
            </div>
            <div class="feature-arrow">â†’</div>
        </a>

        <a href="{{ url_for('motivation') }}" class="feature-card feature-motivation">
            <div class="feature-icon">ğŸ”¥</div>
            <div class="feature-content">
                <h3>ç¨‹åºå‘˜é¼“åŠ±å¤§å¸ˆ</h3>
                <p>ç²¾ç¥é¢†è¢– Â· å¿ƒæ€ä¿®ç‚¼</p>
            </div>
            <div class="feature-arrow">â†’</div>
        </a>

        <a href="{{ url_for('bubble') }}" class="feature-card feature-bubble">
            <div class="feature-icon">ğŸ«§</div>
            <div class="feature-content">
                <h3>æ°”æ³¡å›¾å·¥å…·</h3>
                <p>å¯è§†åŒ–æ€ç»´å¯¼å›¾</p>
            </div>
            <div class="feature-arrow">â†’</div>
        </a>

        <a href="{{ url_for('aichat') }}" class="feature-card feature-ai">
            <div class="feature-icon">ğŸ¤–</div>
            <div class="feature-content">
                <h3>æ™ºè„‘ä¸­æ¢</h3>
                <p>AI æ™ºèƒ½åŠ©æ‰‹</p>
            </div>
            <div class="feature-arrow">â†’</div>
        </a>

        <a href="{{ url_for('prompt_todo') }}" class="feature-card feature-prompt-todo">
            <div class="feature-icon">ğŸ“‹</div>
            <div class="feature-content">
                <h3>å¾…æ‰§è¡ŒPrompt</h3>
                <p>Prompt ä»»åŠ¡é˜Ÿåˆ—</p>
            </div>
            <div class="feature-arrow">â†’</div>
        </a>

        <a href="{{ url_for('prompts') }}" class="feature-card feature-prompts">
            <div class="feature-icon">ğŸ“œ</div>
            <div class="feature-content">
                <h3>Promptå†å²</h3>
                <p>Prompt å½’æ¡£è®°å½•</p>
            </div>
            <div class="feature-arrow">â†’</div>
        </a>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <h2 class="section-title">å¿«æ·æ“ä½œ</h2>
        <div class="action-buttons">
            <button class="action-btn" onclick="location.href='{{ url_for('todo') }}'">
                <span class="action-icon">â•</span>
                <span>æ·»åŠ ä»»åŠ¡</span>
            </button>
            <button class="action-btn" onclick="location.href='{{ url_for('prompt_todo') }}'">
                <span class="action-icon">ğŸ“</span>
                <span>æ–°å»ºPrompt</span>
            </button>
            <button class="action-btn" onclick="location.href='{{ url_for('bubble') }}'">
                <span class="action-icon">ğŸ¨</span>
                <span>åˆ›å»ºæ°”æ³¡å›¾</span>
            </button>
            <button class="action-btn" onclick="location.href='{{ url_for('aichat') }}'">
                <span class="action-icon">ğŸ’¬</span>
                <span>AIå¯¹è¯</span>
            </button>
        </div>
    </div>
</div>

<style>
.main-dashboard {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

/* Welcome Header */
.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 30px;
    margin-bottom: 30px;
}

.welcome-section {
    flex: 1;
}

.welcome-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0 0 8px 0;
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.welcome-date {
    font-size: 1rem;
    color: var(--text-muted);
    margin: 0;
}

.quote-card {
    flex: 1;
    max-width: 400px;
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 16px 20px;
    background: linear-gradient(135deg, rgba(102,126,234,0.08), rgba(118,75,162,0.08));
    border-radius: 12px;
    border-left: 3px solid var(--primary-color);
}

.quote-icon {
    font-size: 1.2rem;
    flex-shrink: 0;
}

.quote-text {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin: 0;
    line-height: 1.5;
    font-style: italic;
}

/* Stats Row */
.stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 30px;
}

.stat-card {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 20px;
    background: var(--bg-card);
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    transition: transform 0.2s, box-shadow 0.2s;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
}

.stat-card-link {
    text-decoration: none;
    cursor: pointer;
}

.stat-card-link:hover {
    background: linear-gradient(135deg, rgba(102,126,234,0.05), rgba(118,75,162,0.05));
}

/* å¤©æ°”å¡ç‰‡ç‰¹æ®Šæ ·å¼ */
.weather-card {
    background: linear-gradient(135deg, rgba(96,165,250,0.1), rgba(52,211,153,0.1));
    border: 1px solid rgba(96,165,250,0.2);
}

.weather-card .stat-icon {
    background: linear-gradient(135deg, rgba(96,165,250,0.2), rgba(52,211,153,0.2));
    font-size: 2rem;
}

.stat-icon {
    font-size: 1.8rem;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
    border-radius: 12px;
}

.stat-info {
    display: flex;
    flex-direction: column;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
}

.stat-label {
    font-size: 0.8rem;
    color: var(--text-muted);
}

/* Feature Grid */
.feature-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 30px;
}

.feature-card {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 24px;
    background: var(--bg-card);
    border-radius: 16px;
    text-decoration: none;
    box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.feature-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    opacity: 0;
    transition: opacity 0.3s;
}

.feature-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.1);
}

.feature-card:hover::before {
    opacity: 1;
}

.feature-todo::before { background: linear-gradient(90deg, #10b981, #34d399); }
.feature-motivation::before { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
.feature-bubble::before { background: linear-gradient(90deg, #667eea, #764ba2); }
.feature-ai::before { background: linear-gradient(90deg, #8b5cf6, #a78bfa); }
.feature-prompt-todo::before { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
.feature-prompts::before { background: linear-gradient(90deg, #6366f1, #818cf8); }

.feature-icon {
    font-size: 2rem;
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 14px;
    flex-shrink: 0;
}

.feature-todo .feature-icon { background: rgba(16,185,129,0.1); }
.feature-motivation .feature-icon { background: rgba(245,158,11,0.1); }
.feature-bubble .feature-icon { background: rgba(102,126,234,0.1); }
.feature-ai .feature-icon { background: rgba(139,92,246,0.1); }
.feature-prompt-todo .feature-icon { background: rgba(59,130,246,0.1); }
.feature-prompts .feature-icon { background: rgba(99,102,241,0.1); }

.feature-content {
    flex: 1;
}

.feature-content h3 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 4px 0;
}

.feature-content p {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin: 0;
}

.feature-arrow {
    font-size: 1.2rem;
    color: var(--text-muted);
    opacity: 0;
    transform: translateX(-10px);
    transition: all 0.3s;
}

.feature-card:hover .feature-arrow {
    opacity: 1;
    transform: translateX(0);
}

/* Quick Actions */
.quick-actions {
    background: var(--bg-card);
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.04);
}

.section-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 16px 0;
}

.action-buttons {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
}

.action-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
    border: none;
    border-radius: 10px;
    font-size: 0.9rem;
    color: var(--primary-color);
    cursor: pointer;
    transition: all 0.2s;
}

.action-btn:hover {
    background: linear-gradient(135deg, rgba(102,126,234,0.2), rgba(118,75,162,0.2));
    transform: translateY(-1px);
}

.action-icon {
    font-size: 1.1rem;
}

/* Responsive */
@media (max-width: 1024px) {
    .stats-row {
        grid-template-columns: repeat(2, 1fr);
    }
    .feature-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 640px) {
    .dashboard-header {
        flex-direction: column;
    }
    .quote-card {
        max-width: none;
    }
    .stats-row {
        grid-template-columns: 1fr;
    }
    .feature-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
// Update date
(function() {
    var weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
    var now = new Date();
    var y = now.getFullYear();
    var m = now.getMonth() + 1;
    var d = now.getDate();
    var w = weekdays[now.getDay()];
    document.getElementById('current-date').textContent = y + 'å¹´' + m + 'æœˆ' + d + 'æ—¥ æ˜ŸæœŸ' + w;
})();

// Load stats
(function() {
    // Today tasks count
    fetch('/api/todos?tab=today')
        .then(r => r.json())
        .then(data => {
            var pending = (data.items || []).filter(function(t) { return !t.completed; }).length;
            document.getElementById('stat-today-tasks').textContent = pending;
        });

    // Week tasks count
    fetch('/api/todos?tab=week')
        .then(r => r.json())
        .then(data => {
            var pending = (data.items || []).filter(function(t) { return !t.completed; }).length;
            document.getElementById('stat-week-tasks').textContent = pending;
        });

    // Pending prompts count
    fetch('/api/prompt-todos')
        .then(r => r.json())
        .then(data => {
            var pending = (data.todos || []).filter(function(t) { return t.status === 'å¾…æ‰§è¡Œ'; }).length;
            document.getElementById('stat-pending-prompts').textContent = pending;
        });

    // Bubble charts count
    fetch('/api/bubbles')
        .then(r => r.json())
        .then(data => {
            document.getElementById('stat-bubbles').textContent = (data.bubbles || []).length;
        });

    // å¤©æ°”
    fetch('/api/weather')
        .then(r => r.json())
        .then(data => {
            document.getElementById('weather-icon').textContent = data.icon || 'â˜ï¸';
            document.getElementById('weather-temp').textContent = (data.temp_c || '--') + 'Â°C';
            document.getElementById('weather-desc').textContent = data.description || 'æ»‘é“å¢';

            // æ›´æ–°å…¨å±€å¤©æ°”çŠ¶æ€ï¼ˆä¾›å°é±¼åŠ¨ç”»ä½¿ç”¨ï¼‰
            if (window.currentWeather) {
                window.currentWeather.type = data.weather_type || 'cloudy';
                window.currentWeather.temp = data.temp_c;
                window.currentWeather.updated = true;
            }
        })
        .catch(function() {
            document.getElementById('weather-desc').textContent = 'æ— æ³•è·å–';
        });
})();
</script>
{% endblock %}
